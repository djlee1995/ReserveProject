<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.spring.reserve.repository.MemberRepository">
    <sql id="Where">
        <if test='memberId != null and memberId neq ""'>
            AND memberId = #{memberId}
        </if>
        <if test='phone != null and phone neq ""'>
            AND phone = #{phone}
        </if>
        <if test='name != null and name neq ""'>
            AND name = #{name}
        </if>
        <if test='team != null and team neq ""'>
            AND team = #{team}
        </if>
        <if test='status != null and status neq ""'>
            AND status = #{status}
        </if>
        <if test='role != null and role neq ""'>
            AND role = #{role}
        </if>
    </sql>
    <select id="selectMember" parameterType="MemberVo" resultType="MemberVo">
        SELECT
            memberNo,
            memberId,
            password,
            phone,
            name,
            team,
            status,
            CONCAT('ROLE_',role) role,
            approver,
            createdAt,
            updatedAt
        FROM TB_MEMBER
        <where>
            <include refid="Where" />
        </where>
    </select>

    <select id="selectCountMember" parameterType="MemberVo" resultType="int">
        SELECT COUNT(*) FROM TB_MEMBER
        <where>
            <include refid="Where" />
        </where>
    </select>

    <insert id="addMember" parameterType="MemberVo" useGeneratedKeys="true"  keyProperty="memberNo">
        INSERT INTO TB_MEMBER (memberId, password, phone, name, team)
        VALUES (#{memberId}, #{password}, #{phone}, #{name}, #{team})
    </insert>

    <update id="updateMember" parameterType="MemberVo">
        UPDATE TB_MEMBER SET
                             password = #{password},
                             phone = #{phone},
                             name = #{name},
                             team = #{team},
                             updatedAt = NOW()
                         WHERE memberId=#{memberId}
    </update>
</mapper>